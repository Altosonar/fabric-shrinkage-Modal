<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Shrinkage Control</title>
    <style>
        /* ========== COMPACT SHRINKAGE MODAL STYLES ========== */
        .shrinkage-container {
            font-family: Arial, sans-serif;
            max-width: 350px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            margin: 20px auto;
            position: relative;
        }
        
        .shrinkage-preview {
            padding: 30px 20px 20px 20px;
            background: #f5f7fa;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }
        
        .preview-box {
            width: 200px;
            height: 150px;
            background: linear-gradient(45deg, #e3f2fd 25%, transparent 25%),
                        linear-gradient(-45deg, #e3f2fd 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #e3f2fd 75%),
                        linear-gradient(-45deg, transparent 75%, #e3f2fd 75%);
            background-size: 20px 20px;
            margin: 0 auto 15px auto;
            position: relative;
            border: 2px solid #1976d2;
            border-radius: 4px;
        }
        
        .original-outline {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px dashed rgba(0,0,0,0.2);
            pointer-events: none;
        }
        
        .preview-label {
            font-size: 12px;
            color: #666;
            text-align: center;
        }
        
        .preview-label strong { color: #333; }
        
        .shrinkage-controls { padding: 20px; }
        .control-group { margin-bottom: 20px; }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .control-label {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .control-value {
            font-size: 14px;
            font-weight: bold;
            color: #1976d2;
            min-width: 40px;
            text-align: right;
        }
        
        /* SLIDER STYLING */
        .slider-container {
            position: relative;
            margin-bottom: 5px;
            height: 44px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .slider-track {
            width: 100%;
            height: 12px;
            background: linear-gradient(to right, #F44336, #F44336 50%, #4CAF50 50%, #4CAF50);
            border-radius: 6px;
            position: relative;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            overflow: visible;
        }
        
        .slider-track::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #333;
            transform: translateX(-50%);
            z-index: 1;
        }
        
        .slider-thumb {
            position: absolute;
            width: 28px;
            height: 28px;
            background: white;
            border: 3px solid #333;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: grab;
            z-index: 10;
            user-select: none;
            transition: all 0.1s ease;
        }
        
        .slider-thumb:active,
        .slider-thumb.dragging {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .slider-value-display {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: #666;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .slider-value-display::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #666;
        }
        
        .slider-thumb:hover .slider-value-display,
        .slider-thumb.dragging .slider-value-display {
            opacity: 1;
        }
        
        .slider-ticks {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .slider-tick {
            font-size: 11px;
            color: #666;
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .slider-tick::before {
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 8px;
            background: rgba(0,0,0,0.2);
        }
        
        .slider-tick:nth-child(3)::before {
            background: #333;
            width: 2px;
            height: 10px;
        }
        
        .slider-tick:first-child,
        .slider-tick:last-child {
            flex: 0 0 auto;
        }
        
        .slider-tick:first-child {
            text-align: left;
        }
        
        .slider-tick:last-child {
            text-align: right;
        }

        /* Plus/Minus Controls */
        .pm-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pm-button {
            width: 44px;
            height: 44px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            font-size: 22px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            transition: all 0.15s;
        }
        
        .pm-button:hover {
            background: #f5f5f5;
            border-color: #999;
        }
        
        .pm-button:active { 
            background: #e9ecef; 
            transform: scale(0.95); 
        }
        
        .pm-button.active {
            background: #e9ecef;
            border-color: #1976d2;
        }
        
        .pm-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            min-height: 44px;
        }
        
        .pm-input:focus {
            outline: none;
            border-color: #1976d2;
        }
        
        .action-buttons { 
            display: flex; 
            gap: 10px; 
            margin-top: 25px; 
        }
        
        .action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-btn { 
            background: #f5f5f5; 
            color: #666; 
            border: 2px solid #ddd; 
        }
        
        .reset-btn:hover {
            background: #e0e0e0;
        }
        
        .apply-btn { 
            background: linear-gradient(135deg, #1976d2, #0d47a1); 
            color: white; 
        }
        
        .apply-btn:hover {
            background: linear-gradient(135deg, #1565c0, #0d3b7a);
        }

        .shrinkage-close {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
            z-index: 100;
        }
        
        .shrinkage-close:hover {
            background: rgba(0,0,0,0.1);
        }
        
        .shrinkage-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .info-tooltip {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #666;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            text-align: center;
            line-height: 18px;
            margin-left: 5px;
            cursor: help;
            position: relative;
        }
        
        .info-tooltip:hover::after {
            content: "Red = Expand | Green = Shrink";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
        }
        
        @keyframes clickFeedback {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        .click-feedback {
            animation: clickFeedback 0.2s ease;
        }
    </style>
</head>
<body>

    <div class="shrinkage-container" id="shrinkageModal">
        <button class="shrinkage-close" onclick="closeModal()">√ó</button>
        
        <div class="shrinkage-preview">
            <div class="preview-box" id="previewBox">
                <div class="original-outline" id="originalOutline" style="width: 200px; height: 150px;"></div>
                <div id="scaledPreview" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                                              background: rgba(25, 118, 210, 0.7); border: 2px solid #1976d2;
                                              border-radius: 4px; transition: all 0.1s ease; width: 200px; height: 150px;"></div>
            </div>
            <div class="preview-label">
                Preview: <span style="text-decoration: line-through; color: #666;">Original</span> 
                vs <strong>After Shrinkage</strong> 
                <span id="scaleIndicator" class="shrinkage-indicator">0%</span>
            </div>
        </div>
        
        <div class="shrinkage-controls">
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">OVERALL SHRINKAGE 
                        <span class="info-tooltip">i</span>
                    </span>
                    <span class="control-value" id="overallValue">0%</span>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="overallSliderTrack">
                        <div class="slider-thumb" id="overallSliderThumb" style="left: 50%;">
                            <div class="slider-value-display" id="overallSliderValue">0%</div>
                        </div>
                    </div>
                    <div class="slider-ticks">
                        <span class="slider-tick">-30%</span>
                        <span class="slider-tick">-15%</span>
                        <span class="slider-tick">0%</span>
                        <span class="slider-tick">15%</span>
                        <span class="slider-tick">30%</span>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">WIDTH SHRINKAGE %</span>
                    <span class="control-value" id="widthDisplay">0</span>
                </div>
                <div class="pm-controls">
                    <button class="pm-button" 
                            onmousedown="startContinuousAdjust('width', -1, this)" 
                            onmouseup="stopContinuousAdjust('width')" 
                            onmouseleave="stopContinuousAdjust('width')"
                            ontouchstart="startContinuousAdjust('width', -1, this)" 
                            ontouchend="stopContinuousAdjust('width')"
                            id="widthDecreaseBtn">-</button>
                    <input type="number" class="pm-input" id="widthInput" value="0" min="-30" max="30">
                    <button class="pm-button" 
                            onmousedown="startContinuousAdjust('width', 1, this)" 
                            onmouseup="stopContinuousAdjust('width')" 
                            onmouseleave="stopContinuousAdjust('width')"
                            ontouchstart="startContinuousAdjust('width', 1, this)" 
                            ontouchend="stopContinuousAdjust('width')"
                            id="widthIncreaseBtn">+</button>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">HEIGHT SHRINKAGE %</span>
                    <span class="control-value" id="heightDisplay">0</span>
                </div>
                <div class="pm-controls">
                    <button class="pm-button" 
                            onmousedown="startContinuousAdjust('height', -1, this)" 
                            onmouseup="stopContinuousAdjust('height')" 
                            onmouseleave="stopContinuousAdjust('height')"
                            ontouchstart="startContinuousAdjust('height', -1, this)" 
                            ontouchend="stopContinuousAdjust('height')"
                            id="heightDecreaseBtn">-</button>
                    <input type="number" class="pm-input" id="heightInput" value="0" min="-30" max="30">
                    <button class="pm-button" 
                            onmousedown="startContinuousAdjust('height', 1, this)" 
                            onmouseup="stopContinuousAdjust('height')" 
                            onmouseleave="stopContinuousAdjust('height')"
                            ontouchstart="startContinuousAdjust('height', 1, this)" 
                            ontouchend="stopContinuousAdjust('height')"
                            id="heightIncreaseBtn">+</button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn reset-btn" onclick="resetAllControls()" id="resetBtn">RESET ALL</button>
                <button class="action-btn apply-btn" onclick="applyShrinkage()" id="applyBtn">APPLY CHANGES</button>
            </div>
        </div>
    </div>

    <script>
        // ========== SHRINKAGE FUNCTIONALITY ==========
        
        // State
        let shrinkageState = {
            overall: 0,
            width: 0,
            height: 0
        };
        
        // Original dimensions
        const originalDimensions = {
            width: 200,
            height: 150
        };
        
        // Current transform
        let currentTransform = { scaleX: 1, scaleY: 1 };
        
        // Slider state
        let isDragging = false;
        let currentSliderValue = 0;
        
        // Continuous adjustment
        let continuousAdjustTimers = {
            width: null,
            height: null
        };
        
        let continuousAdjustButtons = {
            width: { plus: null, minus: null },
            height: { plus: null, minus: null }
        };
        
        let continuousAdjustSpeeds = {
            width: 1,
            height: 1
        };
        
        // DOM Elements
        const elements = {
            overallValue: document.getElementById('overallValue'),
            widthInput: document.getElementById('widthInput'),
            widthDisplay: document.getElementById('widthDisplay'),
            heightInput: document.getElementById('heightInput'),
            heightDisplay: document.getElementById('heightDisplay'),
            scaledPreview: document.getElementById('scaledPreview'),
            originalOutline: document.getElementById('originalOutline'),
            scaleIndicator: document.getElementById('scaleIndicator'),
            overallSliderThumb: document.getElementById('overallSliderThumb'),
            overallSliderTrack: document.getElementById('overallSliderTrack'),
            overallSliderValue: document.getElementById('overallSliderValue'),
            resetBtn: document.getElementById('resetBtn'),
            applyBtn: document.getElementById('applyBtn'),
            widthDecreaseBtn: document.getElementById('widthDecreaseBtn'),
            widthIncreaseBtn: document.getElementById('widthIncreaseBtn'),
            heightDecreaseBtn: document.getElementById('heightDecreaseBtn'),
            heightIncreaseBtn: document.getElementById('heightIncreaseBtn')
        };
        
        // Calculate scale factor (negative values = expansion, positive = shrinkage)
        function calculateScaleFactor(percent) {
            return 1 - (percent / 100);
        }
        
        // Update slider thumb position and colors
        function updateSliderThumb(value) {
            const clampedValue = Math.max(-30, Math.min(30, value));
            const percentage = ((clampedValue + 30) / 60) * 100;
            const clampedPercentage = Math.max(0, Math.min(100, percentage));
            
            // Update position
            elements.overallSliderThumb.style.left = clampedPercentage + '%';
            elements.overallSliderValue.textContent = clampedValue + '%';
            
            // Update colors based on value
            if (clampedValue < 0) {
                // RED ZONE - EXPANSION
                elements.overallSliderThumb.style.borderColor = '#F44336';
                elements.overallSliderThumb.style.background = '#FFEBEE';
                elements.overallSliderValue.style.background = '#F44336';
                elements.overallSliderValue.style.color = 'white';
                elements.overallValue.style.color = '#F44336';
            } else if (clampedValue > 0) {
                // GREEN ZONE - SHRINKAGE
                elements.overallSliderThumb.style.borderColor = '#4CAF50';
                elements.overallSliderThumb.style.background = '#E8F5E9';
                elements.overallSliderValue.style.background = '#4CAF50';
                elements.overallSliderValue.style.color = 'white';
                elements.overallValue.style.color = '#4CAF50';
            } else {
                // ZERO POINT - NEUTRAL
                elements.overallSliderThumb.style.borderColor = '#333';
                elements.overallSliderThumb.style.background = 'white';
                elements.overallSliderValue.style.background = '#666';
                elements.overallSliderValue.style.color = 'white';
                elements.overallValue.style.color = '#1976d2';
            }
        }
        
        // Update slider from mouse/touch position
        function updateSliderFromPosition(clientX) {
            const track = elements.overallSliderTrack;
            const rect = track.getBoundingClientRect();
            
            let position = (clientX - rect.left) / rect.width;
            position = Math.max(0, Math.min(1, position));
            
            const rawValue = (position * 60) - 30;
            const value = Math.max(-30, Math.min(30, Math.round(rawValue)));
            
            if (value !== currentSliderValue) {
                currentSliderValue = value;
                shrinkageState.overall = value;
                
                elements.overallValue.textContent = value + '%';
                updateSliderThumb(value);
                updatePreview();
            }
        }
        
        // Start continuous adjustment
        function startContinuousAdjust(type, amount, button) {
            stopContinuousAdjust(type);
            
            button.classList.add('active');
            
            if (amount > 0) {
                continuousAdjustButtons[type].plus = button;
            } else {
                continuousAdjustButtons[type].minus = button;
            }
            
            adjustControl(type, amount);
            
            continuousAdjustTimers[type] = setTimeout(() => {
                continuousAdjustSpeeds[type] = 3;
                continuousAdjustTimers[type] = setInterval(() => {
                    adjustControl(type, amount * continuousAdjustSpeeds[type]);
                }, 80);
            }, 500);
        }
        
        // Stop continuous adjustment
        function stopContinuousAdjust(type) {
            if (continuousAdjustTimers[type]) {
                clearTimeout(continuousAdjustTimers[type]);
                clearInterval(continuousAdjustTimers[type]);
                continuousAdjustTimers[type] = null;
            }
            
            continuousAdjustSpeeds[type] = 1;
            
            if (continuousAdjustButtons[type].plus) {
                continuousAdjustButtons[type].plus.classList.remove('active');
                continuousAdjustButtons[type].plus = null;
            }
            if (continuousAdjustButtons[type].minus) {
                continuousAdjustButtons[type].minus.classList.remove('active');
                continuousAdjustButtons[type].minus = null;
            }
        }
        
        // Handle slider drag start
        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
            elements.overallSliderThumb.classList.add('dragging');
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchmove', handleDrag, { passive: false });
            document.addEventListener('touchend', stopDrag, { passive: false });
            
            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            updateSliderFromPosition(clientX);
        }
        
        // Handle slider dragging
        function handleDrag(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            updateSliderFromPosition(clientX);
        }
        
        // Stop dragging
        function stopDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            elements.overallSliderThumb.classList.remove('dragging');
            
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', handleDrag);
            document.removeEventListener('touchend', stopDrag);
            
            elements.overallSliderThumb.classList.add('click-feedback');
            setTimeout(() => {
                elements.overallSliderThumb.classList.remove('click-feedback');
            }, 200);
        }
        
        // Handle track click
        function handleTrackClick(e) {
            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            updateSliderFromPosition(clientX);
            
            elements.overallSliderTrack.classList.add('click-feedback');
            setTimeout(() => {
                elements.overallSliderTrack.classList.remove('click-feedback');
            }, 200);
        }
        
        // Adjust control value
        function adjustControl(type, amount) {
            const input = elements[type + 'Input'];
            const valueSpan = elements[type + 'Display'];
            
            let current = parseInt(input.value) || 0;
            let newValue = current + amount;
            
            newValue = Math.max(-30, Math.min(30, newValue));
            
            input.value = newValue;
            valueSpan.textContent = newValue;
            
            // Color code the value display
            if (newValue < 0) {
                valueSpan.style.color = '#F44336';
            } else if (newValue > 0) {
                valueSpan.style.color = '#4CAF50';
            } else {
                valueSpan.style.color = '#1976d2';
            }
            
            shrinkageState[type] = newValue;
            updatePreview();
        }
        
        // Update preview visualization
        function updatePreview() {
            const overall = currentSliderValue;
            const width = parseInt(elements.widthInput.value) || 0;
            const height = parseInt(elements.heightInput.value) || 0;
            
            // Calculate scale factors
            const overallFactor = calculateScaleFactor(overall);
            const widthFactor = calculateScaleFactor(width);
            const heightFactor = calculateScaleFactor(height);
            
            // Combined scale (multiplicative)
            const scaleX = overallFactor * widthFactor;
            const scaleY = overallFactor * heightFactor;
            
            // Update preview box
            const baseWidth = originalDimensions.width;
            const baseHeight = originalDimensions.height;
            
            elements.scaledPreview.style.width = (baseWidth * scaleX) + 'px';
            elements.scaledPreview.style.height = (baseHeight * scaleY) + 'px';
            
            // Calculate percentage change
            const widthChange = (scaleX - 1) * 100;
            const heightChange = (scaleY - 1) * 100;
            const avgChange = (widthChange + heightChange) / 2;
            
            // Update scale indicator
            let changeText = '';
            
            if (avgChange < 0) {
                changeText = `Shrink: ${Math.abs(avgChange).toFixed(1)}%`;
                elements.scaleIndicator.style.background = '#E8F5E9';
                elements.scaleIndicator.style.color = '#2E7D32';
            } else if (avgChange > 0) {
                changeText = `Expand: ${avgChange.toFixed(1)}%`;
                elements.scaleIndicator.style.background = '#FFEBEE';
                elements.scaleIndicator.style.color = '#C62828';
            } else {
                changeText = '0%';
                elements.scaleIndicator.style.background = '#F5F5F5';
                elements.scaleIndicator.style.color = '#666';
            }
            
            elements.scaleIndicator.textContent = changeText;
        }
        
        // Apply shrinkage
        function applyShrinkage() {
            const overall = currentSliderValue;
            const width = parseInt(elements.widthInput.value) || 0;
            const height = parseInt(elements.heightInput.value) || 0;
            
            // Calculate final scale
            const overallFactor = calculateScaleFactor(overall);
            const widthFactor = calculateScaleFactor(width);
            const heightFactor = calculateScaleFactor(height);
            
            const scaleX = overallFactor * widthFactor;
            const scaleY = overallFactor * heightFactor;
            
            // Store current transform
            currentTransform = { scaleX, scaleY };
            
            // Calculate new dimensions
            const newWidth = Math.round(originalDimensions.width * scaleX);
            const newHeight = Math.round(originalDimensions.height * scaleY);
            
            // Add click feedback
            elements.applyBtn.classList.add('click-feedback');
            setTimeout(() => {
                elements.applyBtn.classList.remove('click-feedback');
            }, 200);
            
            // Show success message
            setTimeout(() => {
                const widthChange = (scaleX - 1) * 100;
                const heightChange = (scaleY - 1) * 100;
                
                let message = `‚úÖ Shrinkage applied!\n\n`;
                message += `üìè Original: ${originalDimensions.width} √ó ${originalDimensions.height}\n`;
                message += `üìê New Size: ${newWidth} √ó ${newHeight}\n\n`;
                
                if (widthChange < 0) {
                    message += `‚ÜîÔ∏è Width: ${Math.abs(widthChange).toFixed(1)}% shrinkage\n`;
                } else if (widthChange > 0) {
                    message += `‚ÜîÔ∏è Width: ${widthChange.toFixed(1)}% expansion\n`;
                } else {
                    message += `‚ÜîÔ∏è Width: No change\n`;
                }
                
                if (heightChange < 0) {
                    message += `‚ÜïÔ∏è Height: ${Math.abs(heightChange).toFixed(1)}% shrinkage\n`;
                } else if (heightChange > 0) {
                    message += `‚ÜïÔ∏è Height: ${heightChange.toFixed(1)}% expansion\n`;
                } else {
                    message += `‚ÜïÔ∏è Height: No change\n`;
                }
                
                alert(message);
            }, 100);
        }
        
        // Reset all controls
        function resetAllControls() {
            stopContinuousAdjust('width');
            stopContinuousAdjust('height');
            
            elements.widthInput.value = 0;
            elements.heightInput.value = 0;
            
            elements.overallValue.textContent = '0%';
            elements.widthDisplay.textContent = '0';
            elements.heightDisplay.textContent = '0';
            
            elements.overallValue.style.color = '#1976d2';
            elements.widthDisplay.style.color = '#1976d2';
            elements.heightDisplay.style.color = '#1976d2';
            
            currentSliderValue = 0;
            shrinkageState.overall = 0;
            shrinkageState.width = 0;
            shrinkageState.height = 0;
            
            updateSliderThumb(0);
            updatePreview();
            
            currentTransform = { scaleX: 1, scaleY: 1 };
            
            elements.resetBtn.classList.add('click-feedback');
            setTimeout(() => {
                elements.resetBtn.classList.remove('click-feedback');
            }, 200);
        }
        
        // Close modal
        function closeModal() {
            document.querySelector('.shrinkage-container').style.display = 'none';
            stopContinuousAdjust('width');
            stopContinuousAdjust('height');
        }
        
        // Initialize event listeners
        function setupEventListeners() {
            // Slider drag events
            elements.overallSliderThumb.addEventListener('mousedown', startDrag);
            elements.overallSliderThumb.addEventListener('touchstart', startDrag, { passive: false });
            
            // Track click events
            elements.overallSliderTrack.addEventListener('click', handleTrackClick);
            elements.overallSliderTrack.addEventListener('touchstart', handleTrackClick, { passive: false });
            
            // Input fields with validation
            ['width', 'height'].forEach(type => {
                const input = elements[type + 'Input'];
                const valueSpan = elements[type + 'Display'];
                
                input.addEventListener('input', function() {
                    let value = parseInt(this.value) || 0;
                    
                    if (value < -30 || value > 30) {
                        this.style.borderColor = '#F44336';
                    } else {
                        this.style.borderColor = '';
                        
                        if (value < 0) {
                            valueSpan.style.color = '#F44336';
                        } else if (value > 0) {
                            valueSpan.style.color = '#4CAF50';
                        } else {
                            valueSpan.style.color = '#1976d2';
                        }
                    }
                    
                    value = Math.max(-30, Math.min(30, value));
                    this.value = value;
                    valueSpan.textContent = value;
                    shrinkageState[type] = value;
                    updatePreview();
                });
                
                input.addEventListener('blur', function() {
                    let value = parseInt(this.value) || 0;
                    value = Math.max(-30, Math.min(30, value));
                    this.value = value;
                    valueSpan.textContent = value;
                    
                    if (value < 0) {
                        valueSpan.style.color = '#F44336';
                    } else if (value > 0) {
                        valueSpan.style.color = '#4CAF50';
                    } else {
                        valueSpan.style.color = '#1976d2';
                    }
                    
                    shrinkageState[type] = value;
                    updatePreview();
                });
                
                // Initial color coding
                if (parseInt(input.value) < 0) {
                    valueSpan.style.color = '#F44336';
                } else if (parseInt(input.value) > 0) {
                    valueSpan.style.color = '#4CAF50';
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    e.preventDefault();
                }
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    applyShrinkage();
                    e.preventDefault();
                }
                if (e.key === 'r' && e.ctrlKey) {
                    resetAllControls();
                    e.preventDefault();
                }
                
                // Arrow key navigation for inputs
                if (e.target.classList.contains('pm-input')) {
                    if (e.key === 'ArrowUp') {
                        const type = e.target.id.replace('Input', '');
                        adjustControl(type, 1);
                        e.preventDefault();
                    } else if (e.key === 'ArrowDown') {
                        const type = e.target.id.replace('Input', '');
                        adjustControl(type, -1);
                        e.preventDefault();
                    }
                }
            });
            
            // Prevent form submission on Enter in inputs
            document.querySelectorAll('.pm-input').forEach(input => {
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
            
            // Prevent context menu on slider
            elements.overallSliderThumb.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
            
            // Stop continuous adjustment when mouse leaves window
            window.addEventListener('mouseup', function() {
                stopContinuousAdjust('width');
                stopContinuousAdjust('height');
            });
            
            window.addEventListener('touchend', function() {
                stopContinuousAdjust('width');
                stopContinuousAdjust('height');
            });
        }
        
        // Initialize
        function initShrinkageModule() {
            elements.overallValue.textContent = '0%';
            elements.widthDisplay.textContent = elements.widthInput.value;
            elements.heightDisplay.textContent = elements.heightInput.value;
            
            elements.originalOutline.style.width = originalDimensions.width + 'px';
            elements.originalOutline.style.height = originalDimensions.height + 'px';
            
            setupEventListeners();
            updateSliderThumb(0);
            updatePreview();
        }
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', initShrinkageModule);
        
        // Make functions available globally
        window.startContinuousAdjust = startContinuousAdjust;
        window.stopContinuousAdjust = stopContinuousAdjust;
        window.adjustControl = adjustControl;
        window.applyShrinkage = applyShrinkage;
        window.resetAllControls = resetAllControls;
        window.closeModal = closeModal;
    </script>
</body>
</html>